contract: arseq_plus_phase4
version: 1.0.0
status: frozen
cdd_spec: "1.1.5"

description: |
  ARSEq+ Phase 4: Signal handlers and OSC communication
  Connects UI controls to signals and defines OSC paths.
  
  Source ref:
    - src/gui/modulator_slot.py (existing patterns)
    - src/config/__init__.py (OSC_PATHS)

runner:
  executor: shell

requirements:
  - id: R001
    priority: must
    description: ARSEq+ envelope signals defined
    source_ref: "modulator_slot.py signals pattern"
    acceptance_criteria:
      - env_attack_changed signal exists
      - env_release_changed signal exists
      - env_curve_changed signal exists
      - env_sync_mode_changed signal exists

  - id: R002
    priority: must
    description: ARSEq+ envelope handler methods
    source_ref: "modulator_slot_builder.py references"
    acceptance_criteria:
      - _on_env_attack_changed method exists
      - _on_env_release_changed method exists
      - _on_env_curve_changed method exists
      - _on_env_sync_mode_changed method exists
      - _on_env_loop_rate_changed method exists

  - id: R003
    priority: must
    description: ARSEq+ style update for accent color
    source_ref: "theme.py accent_mod_arseq_plus"
    acceptance_criteria:
      - _update_style_for_generator handles ARSEq+

  - id: R004
    priority: should
    description: OSC paths for ARSEq+ envelope params
    source_ref: "config/__init__.py OSC_PATHS"
    acceptance_criteria:
      - mod_arseq paths defined in OSC_PATHS

tests:
  - id: T001
    name: env_attack_signal
    requirement: R001
    type: unit
    steps:
      - action: shell
        command: ["grep", "-E", "env_attack_changed.*pyqtSignal", "../src/gui/modulator_slot.py"]
        save_as: result
    assert:
      - op: eq
        actual: $.result.ok
        expected: true

  - id: T002
    name: env_release_signal
    requirement: R001
    type: unit
    steps:
      - action: shell
        command: ["grep", "-E", "env_release_changed.*pyqtSignal", "../src/gui/modulator_slot.py"]
        save_as: result
    assert:
      - op: eq
        actual: $.result.ok
        expected: true

  - id: T003
    name: env_curve_signal
    requirement: R001
    type: unit
    steps:
      - action: shell
        command: ["grep", "-E", "env_curve_changed.*pyqtSignal", "../src/gui/modulator_slot.py"]
        save_as: result
    assert:
      - op: eq
        actual: $.result.ok
        expected: true

  - id: T004
    name: env_sync_mode_signal
    requirement: R001
    type: unit
    steps:
      - action: shell
        command: ["grep", "-E", "env_sync_mode_changed.*pyqtSignal", "../src/gui/modulator_slot.py"]
        save_as: result
    assert:
      - op: eq
        actual: $.result.ok
        expected: true

  - id: T005
    name: handler_env_attack
    requirement: R002
    type: unit
    steps:
      - action: shell
        command: ["grep", "-E", "def _on_env_attack_changed", "../src/gui/modulator_slot.py"]
        save_as: result
    assert:
      - op: eq
        actual: $.result.ok
        expected: true

  - id: T006
    name: handler_env_release
    requirement: R002
    type: unit
    steps:
      - action: shell
        command: ["grep", "-E", "def _on_env_release_changed", "../src/gui/modulator_slot.py"]
        save_as: result
    assert:
      - op: eq
        actual: $.result.ok
        expected: true

  - id: T007
    name: handler_env_curve
    requirement: R002
    type: unit
    steps:
      - action: shell
        command: ["grep", "-E", "def _on_env_curve_changed", "../src/gui/modulator_slot.py"]
        save_as: result
    assert:
      - op: eq
        actual: $.result.ok
        expected: true

  - id: T008
    name: handler_env_sync_mode
    requirement: R002
    type: unit
    steps:
      - action: shell
        command: ["grep", "-E", "def _on_env_sync_mode_changed", "../src/gui/modulator_slot.py"]
        save_as: result
    assert:
      - op: eq
        actual: $.result.ok
        expected: true

  - id: T009
    name: handler_env_loop_rate
    requirement: R002
    type: unit
    steps:
      - action: shell
        command: ["grep", "-E", "def _on_env_loop_rate_changed", "../src/gui/modulator_slot.py"]
        save_as: result
    assert:
      - op: eq
        actual: $.result.ok
        expected: true

  - id: T010
    name: style_arseq_plus
    requirement: R003
    type: unit
    steps:
      - action: shell
        command: ["grep", "-E", "ARSEq|arseq_plus", "../src/gui/modulator_slot.py"]
        save_as: result
    assert:
      - op: eq
        actual: $.result.ok
        expected: true

  - id: T011
    name: osc_paths_arseq
    requirement: R004
    type: unit
    steps:
      - action: shell
        command: ["grep", "-E", "mod_arseq|arseq_plus", "../src/config/__init__.py"]
        save_as: result
    assert:
      - op: eq
        actual: $.result.ok
        expected: true
